<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">

    <title>COVID-19 Dashboard</title>

    <!-- Load the Chart.js and moment.js libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>

    <!--Jquery-->
    <script src="https://code.jquery.com/jquery-1.12.3.js"></script>

    <!--DATATABLES-->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">
<!--    add these imports-->
<!--    https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css-->
<!--https://cdn.datatables.net/1.10.21/css/dataTables.jqueryui.min.css-->
<!--https://cdn.datatables.net/scroller/2.0.2/css/scroller.jqueryui.min.css-->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>
    <script src="https://cdn.datatables.net/plug-ins/1.10.21/features/pageResize/dataTables.pageResize.min.js"></script>


    <!--CSS templates-->
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'dashboard/layout.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'dashboard/modal-grid.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'dashboard/main-grid.css' %}">
    <!--    <link rel="stylesheet" type="text/css" href="{% static 'dashboard/datatable.css' %}">-->

    <!--ARCGIS-->
    <link rel="stylesheet" href="https://js.arcgis.com/4.15/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.15/"></script>


    <script>

        const HOST_NAME = "http://localhost:8000"

        function isMobileDevice() {
            return (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1);
        }

        let table;
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/geometry/Extent",
            "esri/layers/FeatureLayer",
            "esri/layers/GeoJSONLayer",
            "esri/renderers/DotDensityRenderer",
            "esri/renderers/SimpleRenderer",
            "esri/Graphic",
            "esri/geometry/support/webMercatorUtils",
            "esri/widgets/Home",
            "esri/widgets/Legend",
            "esri/widgets/Expand",
            "esri/widgets/Fullscreen",
            "esri/widgets/Search",
            "esri/widgets/BasemapGallery",
            "esri/widgets/TimeSlider",

        ], function(Map,
                    MapView,
                    Extent,
                    FeatureLayer,
                    GeoJSONLayer,
                    DotDensityRenderer,
                    SimpleRenderer,
                    Graphic,
                    webMercatorUtils,
                    Home,
                    Legend,
                    Expand,
                    Fullscreen,
                    Search,
                    BasemapGallery,
                    TimeSlider,) {

            // //////////
            // DATA fetch
            // //////////

            const urlGeoJSON = HOST_NAME + "/dashboard/api/get-points/"
            const QuerySettings = {
                url: urlGeoJSON,
                method: "GET",
                success: function (data) {
                    populateDataTable(JSON.parse(data));

                    const blob = new Blob([(data)], {type: "application/json"});
                    const urlLayer  = URL.createObjectURL(blob);
                    createMap(urlLayer);
                },
                error: function (e) {
                    console.log("There was an error with your request...");
                    console.log("error: " + JSON.stringify(e));
                }
            };

            $.ajax(QuerySettings);


            // /////////////////
            // Create data table
            // /////////////////

            function populateDataTable(data) {

                table = $('#side-table').DataTable( {
                    data: data.features,
                    columns: [
                        {
                            data: "properties.date_test",
                            // render: function ( data, type, row ) {
                            //     const dateSplit = data.split('T')[0].split('-');
                            //     return type === "display" || type === "filter" ?
                            //         dateSplit[2] +'-'+ dateSplit[1] +'-'+ dateSplit[0] :
                            //         data;
                            // }
                        },
                        {
                            data: "properties.test_result",
                        },
                        {
                            data: "properties.testing_centre__centre_type",
                        },
                        { data: "properties.testing_centre__postcode" },

                    ],
                    // pageResize: true,
                    // rowId: 'properties.pk',
                    // // scrollY:        '20vh',
                    // //scrollCollapse: true,
                    paging:         false,
                    // bInfo : false,
                     bLengthChange: false,
                    deferRender:    true,
                    scrollY:        200,
                    scrollCollapse: true,
                    scroller:       true
                });


                // Get the modal
                const modal = document.getElementById("myModal");
                const modal_patient_name = document.getElementById("modal-patient-name");
                // Get the <span> element that closes the modal
                const span = document.getElementsByClassName("close")[0];

                $('#side-table tbody').on( 'click', 'tr', function () {
                    let patient_id = table.row( this ).data().properties.patient;
                    const patientURL = HOST_NAME + "/dashboard/api/patient/" + patient_id;
                    const QuerySettings = {
                        url: patientURL,
                        method: "GET",
                        success: function (data) {
                            console.log(data);

                            // add patient name
                            modal_patient_name.innerHTML = data.first_name + " " + data.last_name;

                            // add patient diagnostic test table
                            // $('#patient-table').DataTable( {
                            //     data: data.features,
                            //     columns: [
                            //         {
                            //             data: "properties.date_test",
                            //         },
                            //         {
                            //             data: "properties.test_result",
                            //         },
                            //         {
                            //             data: "properties.testing_centre__centre_type",
                            //         },
                            //         { data: "properties.testing_centre__postcode" },
                            //
                            //     ],
                            //     pageResize: true,
                            //     rowId: 'properties.pk',
                            //     paging:         true,
                            //     bLengthChange: false
                            // });



                            modal.style.display = "block";
                        },
                        error: function (e) {
                            console.log("There was an error when requesting patient information...");
                            console.log("error: " + JSON.stringify(e));
                        }
                    };

                    $.ajax(QuerySettings);
                });

                // When the user clicks on <span> (x), close the modal
                span.onclick = function() {
                    modal.style.display = "none";
                }

                // When the user clicks anywhere outside of the modal, close it
                window.onclick = function(event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                }
            }


            // /////////////////////
            // Create map and layers
            // /////////////////////

            function createMap(geoJSONLayerURL) {

                ///////////
                // Map view

                const map = new Map({
                    basemap: "gray-vector"
                });

                const baseMap = new MapView({
                    container: "viewDiv",
                    map: map,
                    center: [-2.89479, 54.093409],
                    zoom: 5,
                    highlightOptions: {
                        color: [0, 62, 116, 1],
                        haloOpacity: 0.9,
                        fillOpacity: 0.2
                    },
                });


                baseMap
                    .when(function () {
                        // View successfully loaded, show viewDiv
                        document.getElementById("viewDiv").style.display = "flex";
                    })
                    .catch(function (error) {
                        if (error.name.includes("webgl")) {
                            // View was rejected, show webgl unsupported message and turn off the viewDiv
                            const divs = document.getElementsByTagName("div");
                            for (let i = 0; i < divs.length; i++) {
                                divs[i].style.display = 'none';
                            }
                            const webglDiv = document.getElementById("webglNotSupportedDiv");
                            webglDiv.innerHTML = error.message;
                            webglDiv.style.display = "flex";
                            webglDiv.style.visibility = "visible";
                        }
                    });


                /////////////
                // DATA LAYER

                // heatmap renderer
                const heatRenderer = {
                    type: "heatmap",
                    colorStops: [
                        {color: "rgba(63, 40, 102, 0)", ratio: 0},
                        {color: "#e5ff00", ratio: 0.083},
                        {color: "#fff700", ratio: 0.166},
                        {color: "#ffdd00", ratio: 0.249},
                        {color: "#ffd500", ratio: 0.332},
                        {color: "#ffc400", ratio: 0.415},
                        {color: "#ffb300", ratio: 0.498},
                        {color: "#ff9d00", ratio: 0.581},
                        {color: "#ff8400", ratio: 0.664},
                        {color: "#ff5e00", ratio: 0.747},
                        {color: "#ff3c00", ratio: 0.83},
                        {color: "#ff2200", ratio: 0.913},
                        {color: "#ff0000", ratio: 1}
                    ],
                    maxPixelIntensity: 1000,
                    minPixelIntensity: 0,
                };

                const dotRenderer = {
                    type: "unique-value",
                    field: "test_result",
                    defaultSymbol: {
                        type: "simple-marker",
                        color: "orange",
                        size: 8,
                        outline: {
                            color: "none",
                        },
                    },
                    defaultLabel: "n/a",
                    uniqueValueInfos: [{
                        value: "Positive",
                        symbol: {
                            type: "simple-marker",
                            color: "rgba(255, 0, 0, 1)",
                            size: 8,
                            outline: {
                                color: "none",
                            },
                        },
                        label: "Positive"
                    }, {
                        value: "Negative",
                        symbol: {
                            type: "simple-marker",
                            color: "rgba(0, 255, 0, 1)",
                            size: 8,
                            outline: {
                                color: "none",
                            },
                        },
                        label: "Negative",
                    },],
                    outline: {
                        color: "none",
                    },
                };


                // create data layer
                const geoJSONLayer = new GeoJSONLayer({
                    url: geoJSONLayerURL,
                    copyright: "Add copyright for COVID data if needed",
                    renderer: heatRenderer,
                    title: "COVID-19 testing",
                    // featureReduction : {
                    //     type: "cluster",
                    //     clusterRadius: 10,
                    //     popupTemplate: {
                    //         content: "This cluster represents {cluster_count} diagnostic tests."
                    //     }
                    // },
                    timeInfo: {
                        startField: "date_test",
                        interval: {
                            unit: "days",
                            value: 1,
                        }
                    },
                });

                geoJSONLayer.popup = {
                    dockEnabled: true,
                    dockOptions: {
                        buttonEnabled: false,
                        breakpoint: false
                    },
                };

                // add geoJSON layer to map
                map.add(geoJSONLayer);


                /////////
                // Select which dots to display

                function updateRenderer(color, index) {
                    let renderer = geoJSONLayer.renderer.clone();
                    if (index === -1) {
                        renderer.defaultSymbol.color = color;
                    } else {
                        renderer.uniqueValueInfos[index].symbol.color = color;
                    }
                    geoJSONLayer.renderer = renderer;
                }

                const PositiveToggle = document.getElementById("positiveDots");
                const NegativeToggle = document.getElementById("negativeDots");
                const OtherToggle = document.getElementById("otherDots");
                PositiveToggle.addEventListener("change", function () {
                    if (PositiveToggle.checked) updateRenderer("rgba(255, 0, 0, 1)", 0);
                    else updateRenderer("rgba(255, 0, 0, 0)", 0);
                });
                NegativeToggle.addEventListener("change", function () {
                    if (NegativeToggle.checked) updateRenderer("rgba(0, 255, 0, 1)", 1);
                    else updateRenderer("rgba(0, 255, 0, 0)", 1);
                });
                OtherToggle.addEventListener("change", function () {
                    if (OtherToggle.checked) updateRenderer("rgba(255, 165, 0, 1)", -1);
                    else updateRenderer("rgba(255, 165, 0, 0)", -1);
                });


                //renderer selection w/ radio
                let radios = document.getElementsByName("renderer");
                let renderArray = [heatRenderer, dotRenderer];
                for (let i = 0; i < radios.length; i++) {
                    radios[i].addEventListener("change", function (event) {
                        const fieldName = event.target.value;
                        if (fieldName === "HEAT") {
                            renderArray[1] = geoJSONLayer.renderer.clone();
                            $("#dotsCheckboxSettings").hide('slow');
                            geoJSONLayer.renderer = renderArray[0];
                        }
                        if (fieldName === "DOTS") {
                            renderArray[0] = geoJSONLayer.renderer.clone();
                            $("#dotsCheckboxSettings").show('slow');
                            geoJSONLayer.renderer = renderArray[1];
                        }
                    });
                }


                ///////
                // add charts

                let centreChart;

                function createCentreChart() {
                    const centreCanvas = document.getElementById("centre-chart");
                    centreChart = new Chart(centreCanvas.getContext("2d"), {
                        type: "doughnut",
                        data: {
                            labels: ["Home", "Hospital", "GP Clinic", "Drive Through", "Other"],
                            datasets: [
                                {
                                    backgroundColor: [
                                        "#FD7F6F",
                                        "#7EB0D5",
                                        "#B2E061",
                                        "#BD7EBE",
                                        "#FFB55A"
                                    ],
                                    borderWidth: 0,
                                    data: [0, 0, 0, 0, 0]
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            cutoutPercentage: 35,
                            legend: {
                                position: "bottom"
                            },
                            title: {
                                display: true,
                                text: "Centre Type"
                            }
                        }
                    });
                }

                let genderChart;

                function createGenderChart() {
                    const genderCanvas = document.getElementById("gender-chart");
                    genderChart = new Chart(genderCanvas.getContext("2d"), {
                        type: "doughnut",
                        data: {
                            labels: ["Female", "Male", "Other", "Not provided"],
                            datasets: [
                                {
                                    backgroundColor: [
                                        "#FD7F6F",
                                        "#7EB0D5",
                                        "#B2E061",
                                        "#BD7EBE",
                                    ],
                                    borderWidth: 0,
                                    data: [0, 0, 0, 0]
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            cutoutPercentage: 35,
                            legend: {
                                position: "bottom"
                            },
                            title: {
                                display: true,
                                text: "Patient Gender"
                            }
                        }
                    });
                }

                let dateChart;

                function createDateChart() {
                    const dateCanvas = document.getElementById("date-chart");
                    dateChart = new Chart(dateCanvas.getContext("2d"), {
                        type: "line",
                        data: {
                            datasets: [{
                                label: 'Daily Tests',
                                backgroundColor: "#FD7F6F",
                                borderColor: "#B2E061",
                                fill: false,
                                data: [{
                                    x: moment('2016-01-01T00:00:00Z').format(),
                                    y: 1
                                }, {
                                    x: moment('2016-01-08T00:00:00Z').format(),
                                    y: 2
                                }, {
                                    x: moment('2016-01-18T00:00:00Z').format(),
                                    y: 3
                                }, {
                                    x: moment('2016-01-27T00:00:00Z').format(),
                                    y: 4
                                }],
                            }, {
                                label: 'Daily positive tests',
                                backgroundColor: "#7EB0D5",
                                borderColor: "#BD7EBE",
                                fill: false,
                                data: [{
                                    x: moment('2016-01-01T00:00:00Z').format(),
                                    y: 4
                                }, {
                                    x: moment('2016-01-08T00:00:00Z').format(),
                                    y: 3
                                }, {
                                    x: moment('2016-01-18T00:00:00Z').format(),
                                    y: 2
                                }, {
                                    x: moment('2016-01-27T00:00:00Z').format(),
                                    y: 1
                                }],
                            }]
                        },
                        options: {
                            responsive: true,

                            legend: {
                                position: "bottom"
                            },
                            title: {
                                display: true,
                                text: "Testing trends"
                            },
                            scales: {
                                xAxes: [{
                                    type: 'time',
                                    time: {
                                        unit: 'day'
                                    }
                                }]
                            }
                        }
                    });
                }

                createCentreChart();
                createGenderChart();
                createDateChart();

                // used to update charts
                function updateChart(chart, dataValues) {
                    chart.data.datasets[0].data = dataValues;
                    chart.update();
                }


                const selection_name = document.getElementById("selection-name");
                const selection_total = document.getElementById("selection-total");
                const selection_pos = document.getElementById("selection-pos");
                const selection_neg = document.getElementById("selection-neg");

                function queryPopup(target) {
                    //set overview name
                    selection_name.innerHTML = (target.graphic.attributes.nuts118nm || target.graphic.attributes.NAME) || (target.graphic.attributes.NAME_1 + ", " + target.graphic.attributes.POSTCODE_1);

                    const query = geoJSONLayer.createQuery();
                    query.geometry = target.graphic.geometry;
                    query.outStatistics = [

                        {
                            onStatisticField:
                                "CASE WHEN test_result = 'Positive' THEN 1 ELSE 0 END",
                            outStatisticFieldName: "positive",
                            statisticType: "sum"
                        },
                        {
                            onStatisticField:
                                "CASE WHEN test_result = 'Negative' THEN 1 ELSE 0 END",
                            outStatisticFieldName: "negative",
                            statisticType: "sum"
                        },
                        {
                            onStatisticField:
                                "CASE WHEN testing_centre__centre_type = 'Hospital' THEN 1 ELSE 0 END",
                            outStatisticFieldName: "hospital",
                            statisticType: "sum"
                        },
                        {
                            onStatisticField:
                                "CASE WHEN testing_centre__centre_type = 'Other' THEN 1 ELSE 0 END",
                            outStatisticFieldName: "other",
                            statisticType: "sum"
                        },
                        {
                            onStatisticField:
                                "CASE WHEN testing_centre__centre_type = 'GP clinic' THEN 1 ELSE 0 END",
                            outStatisticFieldName: "clinic",
                            statisticType: "sum"
                        },
                        {
                            onStatisticField:
                                "CASE WHEN testing_centre__centre_type = 'Drive through centre' THEN 1 ELSE 0 END",
                            outStatisticFieldName: "drive_through",
                            statisticType: "sum"
                        },
                        {
                            onStatisticField:
                                "CASE WHEN testing_centre__centre_type = 'Home' THEN 1 ELSE 0 END",
                            outStatisticFieldName: "home",
                            statisticType: "sum"
                        },
                        {
                            onStatisticField:
                                "CASE WHEN patient__gender = 'F' THEN 1 ELSE 0 END",
                            outStatisticFieldName: "gen_female",
                            statisticType: "sum"
                        },
                        {
                            onStatisticField:
                                "CASE WHEN patient__gender = 'M' THEN 1 ELSE 0 END",
                            outStatisticFieldName: "gen_male",
                            statisticType: "sum"
                        },
                        {
                            onStatisticField:
                                "CASE WHEN patient__gender = 'O' THEN 1 ELSE 0 END",
                            outStatisticFieldName: "gen_other",
                            statisticType: "sum"
                        },
                        {
                            onStatisticField:
                                "CASE WHEN patient__gender = 'X' THEN 1 ELSE 0 END",
                            outStatisticFieldName: "gen_na",
                            statisticType: "sum"
                        },

                    ];


                    let popup = geoJSONLayer.queryFeatures(query).then(function (response) {
                        let data = response.features[0].attributes;


                        updateChart(centreChart, [
                            data.home,
                            data.hospital,
                            data.clinic,
                            data.drive_through,
                            data.other,
                        ]);

                        updateChart(genderChart, [
                            data.gen_female,
                            data.gen_male,
                            data.gen_other,
                            data.gen_na,
                        ]);

                        // selection_total.innerText = ((data.positive + data.negative) || 0);
                        // selection_pos.innerText = (data.positive || 0);
                        // selection_neg.innerText = (data.negative || 0);

                        return ("<table> <tbody>" +
                            "<tr> <td style=\"padding:0 15px 0 0;\">Total tests:</td> <td>" + ((data.positive + data.negative) || 0) + "</td> </tr>" +
                            "<tr> <td>Positive:</td> <td>" + (data.positive || 0) + "</td> </tr>" +
                            "<tr> <td>Negative:</td> <td>" + (data.negative || 0) + "</td> </tr>" +
                            "</tbody> </table>");
                    });

                    return popup;
                }

                //////
                // add postcode layer

                //renderer
                const lineRenderer = {
                    type: "simple",

                    symbol: {
                        type: "simple-fill",
                        style: "none",
                        outline: {
                            width: 0.1,
                            color: [0, 0, 0, 0.4],
                        },
                    },
                };

                // postcode popup
                const popupPostcode = {
                    title: "{NAME_1}, {POSTCODE_1}",
                    content: queryPopup,
                };

                // postcode layer
                let postcodes = new FeatureLayer({
                    url: "https://services.arcgis.com/dvWpUrMTxKmay5qM/arcgis/rest/services/PCSector%20with%20Regions/FeatureServer",
                    outFields: ["POSTCODE_1", "NAME_1",],
                    popupTemplate: popupPostcode,
                    renderer: lineRenderer,
                    title: "Map features",
                    minScale: 300000,
                    maxScale: 0,
                    legendEnabled: false,
                });

                // popup location
                baseMap.popup = {
                    dockEnabled: true,
                    dockOptions: {
                        buttonEnabled: true,
                        breakpoint: false
                    },
                    collapsed: true,
                };

                // add postcode layer to map
                map.add(postcodes);


                ////////
                // Add countries layer

                const countryPopup = {
                    title: "{NAME}",
                    content: queryPopup,
                };

                //renderer
                const countryRenderer = {
                    type: "simple",
                    symbol: {
                        type: "simple-fill",
                        style: "none",
                        outline: {
                            width: 0.1,
                            color: "none",
                        },
                    },
                };


                let countries = new GeoJSONLayer({
                    url: "{% static 'dashboard/countries.geojson' %}",
                    outFields: ["NAME"],
                    popupTemplate: countryPopup,
                    renderer: countryRenderer,
                    title: "Country",
                    minScale: 0,
                    maxScale: 8000000,
                    legendEnabled: false,
                });

                map.add(countries);


                ////////
                // Add UK regions layer

                const regionPopup = {
                    title: "{nuts118nm}",
                    content: queryPopup,
                };

                let region = new GeoJSONLayer({
                    url: "{% static 'dashboard/regions.geojson' %}",
                    outFields: ["nuts118nm"],
                    popupTemplate: regionPopup,
                    renderer: lineRenderer,
                    title: "Region",
                    minScale: 8000000,
                    maxScale: 300000,
                    legendEnabled: false,
                });

                map.add(region);


                ///////
                //Home button widget to reset view
                const homeWidget = new Home({
                    view: baseMap
                });


                ///////
                // Search widget
                const search = new Search({
                    view: baseMap,
                    locationEnabled: false,
                });


                ///////
                // fullscreen widget
                const fullscreen = new Fullscreen({
                    view: baseMap
                });


                ///////
                // basemap gallery
                const gallery = new BasemapGallery({
                    view: baseMap,
                });


                ///////
                // postcode map toggle
                const PostcodeToggle = document.getElementById("postcodeLayer");
                PostcodeToggle.addEventListener("change", function () {
                    postcodes.visible = PostcodeToggle.checked;
                });


                /////////
                // time slider
                // const timeSlider = new TimeSlider({
                //     container: "timeSlider",
                //     mode: "cumulative-from-start",
                //     view: baseMap
                // });
                //
                // baseMap.ui.add(timeSlider, "manual");
                //
                // baseMap.whenLayerView(geoJSONLayer).then(function(lv) {
                //     const fullTimeExtent = geoJSONLayer.timeInfo.fullTimeExtent;
                //
                //     // set up time slider properties
                //     timeSlider.fullTimeExtent = fullTimeExtent;
                //     timeSlider.playRate = 200;
                //
                //     timeSlider.stops = {
                //         interval: geoJSONLayer.timeInfo.interval,
                //     };
                // });


                ///////
                // add views and widgets
                baseMap.ui.add("selectionPaneDiv", "bottom-left");
                baseMap.ui.add(fullscreen, "bottom-right");
                baseMap.ui.add(homeWidget, "top-left");
                baseMap.ui.add(search, "top-right");
                baseMap.ui.add(
                    [
                        new Expand({
                            view: baseMap,
                            content: gallery,
                            group: "top-left",
                            expanded: false
                        }),
                    ],
                    "top-left"
                );
                baseMap.ui.add(
                    [
                        new Expand({
                            view: baseMap,
                            content: new Legend({view: baseMap}),
                            group: "top-left",
                            expanded: !(isMobileDevice()),
                        }),
                    ],
                    "top-left"
                );
                baseMap.ui.add(
                    [
                        new Expand({
                            view: baseMap,
                            content: document.getElementById("selectionPaneDiv"),
                            group: "bottom-left",
                            expanded: !(isMobileDevice()),
                        }),
                    ],
                    "bottom-left"
                );
            }
        });


    </script>



</head>
<body>

<div class="grid-container">
    <div class="header-container">

        <img src="{% static 'dashboard/images/logo.svg' %}" style='max-height: 100%; width: auto; object-fit: contain'/>



        <h2>
            Centre for Bio-Inspired Technology
        </h2>


    </div>
    <div class="body-container">
        <div id="viewDiv" class="mapView"></div>
        <div class="side-view">
            <div class="graph-container">
                <div class="side-header">
                    <h2 style="display: inline">Overview: </h2><h2 style="display: inline" id="selection-name"></h2>
                </div>
                <div class="pie-container">
                    <div id="centre-chart-div" class="left-pie">
                        <canvas id="centre-chart" width="0" height="0"></canvas>
                    </div>
                    <div id="gender-chart-div" class="right-pie">
                        <canvas id="gender-chart" width="0" height="0"></canvas>
                    </div>
                </div>
                <div id="date-chart-div" class="line-graph-container">
                    <canvas id="date-chart" width="0" height="0"></canvas>
                </div>
            </div>
            <div class="table-container">
                <table id="side-table" class="display compact nowrap" cellspacing="0" width="100%">
                    <thead>
                    <tr>
                        <th>Test Date</th>
                        <th>Result</th>
                        <th>Centre Type</th>
                        <th>Postcode</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>



<!--<div id="viewDiv"></div>-->
<!--<div id="timeSlider"></div>-->
<div id="selectionPaneDiv" class="esri-widget">
    <p>Visualise COVID-19 spread using:</p>
    <label>
        <input type="radio" name="renderer" value="HEAT" checked />
        Heatmap
    </label> <br />

    <label>
        <input type="radio" name="renderer" value="DOTS" />
        Dots
    </label> <br />

    <div id="dotsCheckboxSettings" style="display: none">
        <label>
            <input type="checkbox" id="positiveDots" checked>Show positive test results
        </label>
        <br>
        <label>
            <input type="checkbox" id="negativeDots" checked>Show negative tests results
        </label>
        <br>
        <label>
            <input type="checkbox" id="otherDots" checked>Show inconclusive tests
        </label>
    </div>

    <br />

    <label>
        <input type="checkbox" id="postcodeLayer" checked> Postcode Boundaries
    </label>
</div>


<!-- The Modal -->
<div id="myModal" class="modal">

    <!-- Modal content -->
    <div id="modal-content" class="modal-content">
        <div class="md-grid-container">
            <div class="md-modal-heading">
                <h2 id="modal-patient-name"></h2>
                <div class="close">&times;</div>
            </div>
            <div class="md-modal-body">
                <div class="md-modal-pcr"></div>
                <div class="md-modal-table">
                    <table id="patient-table" class="display compact" cellspacing="0" width="100%">
                        <thead>
                        <tr>
                            <th>Test Date</th>
                            <th>Result</th>
                            <th>Centre Type</th>
                            <th>Postcode</th>
                        </tr>
                        </thead>
                    </table>
                </div>
                <div class="md-modal-patient-info"></div>
                <div class="md-modal-comments"></div>
            </div>
        </div>
    </div>

</div>

</body>
</html>